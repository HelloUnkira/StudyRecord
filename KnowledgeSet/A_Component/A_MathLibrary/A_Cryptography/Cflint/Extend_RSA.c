#include "Cflint.h"
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/
#ifdef EXTEND_USE_RSA
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/
/* 通过目标素数对构造公钥(N, E)和私钥(N, D) */
void RSA_Make(Cflint_Type *P, Cflint_Type *Q, Cflint_Type *N,
              Cflint_Type *E, Cflint_Type *D, Cflint_Type *R,
              Cflint_Type *Temp[9], uint32_t Length)
{
    /* 计算公共模数:N = P * Q */
    Cflint_Multiply(N, P, Q, Length);
    /* 计算欧拉数:R = (P - 1) * (Q - 1) */
    Cflint_SubtractionBit(P, Length, 1);
    Cflint_SubtractionBit(Q, Length, 1);
    Cflint_Multiply(R, P, Q, Length);
    Cflint_AdditionBit(P, Length, 1);
    Cflint_AdditionBit(Q, Length, 1);
    /* 寻找一个小于R的整数E满足GCD(E, R) == 1 */
    Cflint_Copy(E, R, Length * 2);
    do {
        Cflint_SubtractionBit(E, Length * 2, 1);
    } while (Cflint_GCDCheck(R, E, Temp, Length * 2) == false);
    /* 计算乘法逆:D = (1 / E) % R */
    Cflint_GCDInverse(E, N, D, Temp[0], Temp + 1, Length * 2);
}
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/
void RSA_Encrypt(Cflint_Type *N, Cflint_Type *E, Cflint_Type *I,
                 Cflint_Type *O, Cflint_Type *Temp[4], uint32_t Length)
{
    Cflint_ModuloExponent(O, N, I, E, Temp, Length);
}
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/
void RSA_Decrypt(Cflint_Type *N, Cflint_Type *D, Cflint_Type *I,
                 Cflint_Type *O, Cflint_Type *Temp[4], uint32_t Length)
{
    Cflint_ModuloExponent(O, N, I, D, Temp, Length);
}
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/
#endif
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/

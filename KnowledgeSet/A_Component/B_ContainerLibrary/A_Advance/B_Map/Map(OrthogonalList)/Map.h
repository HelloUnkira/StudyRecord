#ifndef MAP_H
#define MAP_H
//C std lib
#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#include "DoubleList.h"
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 载体为十字链表的图 */
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#define Map_GetOwner(Type, Member, MemberAddress)   \
    ((Type *)((uint8_t *)(MemberAddress) - ((uint64_t) &((Type *)0)->Member)))
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
typedef struct MapEdgeStruct {
    DL_Node Parameter1;
    DL_Node Parameter2;
    void   *Parameter3;
    void   *Parameter4;
} MapEdge;
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
typedef struct MapVertexStruct {
    DL_Node Parameter1;
    DL_List Parameter2;
    DL_List Parameter3;
} MapVertex;
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
typedef struct MapBodyStruct {
    DL_List Parameter1;
    void   *Parameter2;
} MapBody;
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
typedef void (*Map_MessageCheck)(char *String, MapVertex *Vertex, MapEdge *Edge);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void Map_MessageCheckAll(MapBody *Map, Map_MessageCheck Check);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void Map_EdgeReset(MapEdge *Edge);
void Map_VertexReset(MapVertex *Vertex);
void Map_BodyReset(MapBody *Map);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void Map_EdgeSet(MapEdge *Edge, MapVertex *Start, MapVertex *End);
void Map_BodySet(MapBody *Map, bool (*Confirm)(MapVertex *Vertex1, MapVertex *Vertex2));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 其他接口的参数都是图中真实存在的顶点和边,如果不知道可以用下面的俩个接口查询 */
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 通过"特性值匹配"的假顶点获取图中的真顶点 */
MapVertex * Map_GetVertex(MapBody *Map, MapVertex *Vertex);
/* 通过图中的俩个真顶点获得真边,如果存在 */
MapEdge * Map_GetEdge(MapVertex *Start, MapVertex *End);
/* 获取图节点数量 */
uint32_t Map_GetVertexNumber(MapBody *Map);
/* 按照顶点加载顺序获得它的虚拟数组映射的下标(用于某些扩展运算) */
uint32_t Map_GetVertexIndex(MapBody *Map, MapVertex *Vertex);
MapVertex * Map_GetVertexFromIndex(MapBody *Map, uint32_t Index);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
MapVertex * Map_EdgeGetStart(MapEdge *Edge);
MapVertex * Map_EdgeGetEnd(MapEdge *Edge);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 图的基本运算 */
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void Map_EdgeAdd(MapEdge *Edge);
void Map_EdgeRemove(MapEdge *Edge);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void Map_VertexAdd(MapBody *Map, MapVertex *Vertex);
void Map_VertexRemove(MapBody *Map, MapVertex *Vertex);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 迭代语义接口 */
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
MapVertex * Map_GetVertexHead(MapBody *Map);
MapVertex * Map_GetVertexTail(MapBody *Map);
MapVertex * Map_GetVertexPrev(MapVertex *Vertex);
MapVertex * Map_GetVertexNext(MapVertex *Vertex);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
MapEdge * Map_GetEdgeFirst(MapVertex *Vertex);
MapEdge * Map_GetEdgeLast(MapVertex *Vertex);
MapEdge * Map_GetEdgePrev(MapEdge *Edge);
MapEdge * Map_GetEdgeNext(MapEdge *Edge);
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 基本图论接口扩展 */
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 深度优先搜索 */
bool Map_SearchDepthFirst(MapBody *Map, MapVertex *Vertex, MapVertex **Stack, bool *Record,
                          uint32_t VertexCount, void (*Visit)(MapVertex *Vertex));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 广度优先搜索 */
bool Map_SearchBreadthFirst(MapBody *Map, MapVertex *Vertex, MapVertex **Queue, bool *Record,
                            uint32_t VertexCount, void (*Visit)(MapVertex *Vertex));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 迪杰斯特拉最短路径搜索(注意: MapVertex *ShortestPath[VertexCount * VertexCount]) */
void Map_SearchDijkstra(MapBody *Map, MapVertex *Vertex, uint32_t *Weight,
                        MapVertex **ShortestPath, bool *Record, uint32_t VertexCount,
                        uint32_t WeightMax, uint32_t (*EdgeWeight)(MapEdge *Edge));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 贝尔曼弗德最短路径搜索(其中ShortestPath类型为: MapVertex *X[][]) */
bool Map_SearchBellmanFord(MapBody *Map, MapVertex *Vertex, uint32_t *Weight,
                           MapVertex **ShortestPath, uint32_t VertexCount,
                           uint32_t WeightMax, uint32_t (*EdgeWeight)(MapEdge *Edge));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 弗洛伊德最短路径搜索(其中ShortestPath类型为: uint32_t X[][]) */
void Map_SearchFloyd(MapBody *Map, uint32_t *Weight, uint32_t *ShortestPath,
                     uint32_t VertexCount, uint32_t WeightMax,
                     uint32_t (*EdgeWeight)(MapEdge *Edge));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 普利姆最小生成树 */
void Map_ToMinTreePrim(MapBody *Map, uint32_t *Matrix, uint32_t *MatrixPrim,
                       bool *NodeSet, uint32_t VertexCount, uint32_t WeightMax,
                       uint32_t (*EdgeWeight)(MapEdge *Edge),
                       uint32_t (*MakeRand)(void));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 凯斯特拉最小生成树 */
void Map_ToMinTreeKruskal(MapBody *Map, uint32_t *Matrix, uint32_t *MatrixTemp,
                          uint32_t *MatrixKruskal, uint32_t *Set, uint32_t *SetFather,
                          uint32_t VertexCount, uint32_t WeightMax,
                          uint32_t (*EdgeWeight)(MapEdge *Edge));
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#endif

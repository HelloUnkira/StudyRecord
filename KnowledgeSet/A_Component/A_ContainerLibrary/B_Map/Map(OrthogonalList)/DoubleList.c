#include <stddef.h>
#include <stdint.h>
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 双向链表迭代器 */
struct DoubleList {
    union {
        struct DoubleList *Prev;//双向链表上一节点
        struct DoubleList *Head;//双向链表头
    };
    union {
        struct DoubleList *Next;//双向链表下一节点
        struct DoubleList *Tail;//双向链表尾
    };
};
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 核心转义 */
typedef struct DoubleList DL_List;
typedef struct DoubleList DL_Node;
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void DL_List_Reset(DL_List *List)
{
    List->Head = NULL;
    List->Tail = NULL;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void DL_Node_Reset(DL_Node *Node)
{
    Node->Prev = NULL;
    Node->Next = NULL;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
DL_Node * DL_List_GetHead(DL_List *List)
{
    return List->Head;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
DL_Node * DL_List_GetTail(DL_List *List)
{
    return List->Tail;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
DL_Node * DL_Node_GetPrev(DL_Node *Node)
{
    return Node->Prev;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
DL_Node * DL_Node_GetNext(DL_Node *Node)
{
    return Node->Next;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 节点前插入(节点Target为NULL时为头部插入) */
void DL_List_InsertPrepend(DL_List *List, DL_Node *Target, DL_Node *Node)
{
    if (Target == NULL) {
        /* 更新插入节点 */
        Node->Prev = NULL;
        Node->Next = List->Head;
        /* 检查头结点 */
        if (List->Head != NULL)
            List->Head->Prev = Node;
        if (List->Head == NULL)
            List->Tail = Node;
        List->Head = Node;
    }
    if (Target != NULL) {
        /* 更新插入节点 */
        Node->Prev = Target->Prev;
        Node->Next = Target;
        /* 前项节点存在时 */
        if (Target->Prev != NULL)
            Target->Prev->Next = Node;
        if (Target->Prev == NULL)
            List->Head = Node;
        /* 更新后项节点 */
        Target->Prev = Node;
    }
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 节点后插入(节点Target为NULL时为尾部插入) */
void DL_List_InsertAppend(DL_List *List, DL_Node *Target, DL_Node *Node)
{
    if (Target == NULL) {
        DL_Node *Tail = DL_List_GetTail(List);
        /* 更新插入节点 */
        Node->Prev = List->Tail;
        Node->Next = NULL;
        /* 检查尾结点 */
        if (List->Tail != NULL)
            List->Tail->Next = Node;
        if (List->Tail == NULL)
            List->Head = Node;
        List->Tail = Node;
    }
    if (Target != NULL) {
        /* 更新插入节点 */
        Node->Prev = Target;
        Node->Next = Target->Next;
        /* 后项节点存在时 */
        if (Target->Next != NULL)
            Target->Next->Prev = Node;
        if (Target->Next == NULL)
            List->Tail = Node;
        /* 更新前项节点 */
        Target->Next = Node;
    }
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 节点移除 */
void DL_List_Remove(DL_List *List, DL_Node *Node)
{
    DL_Node *Prev = DL_Node_GetPrev(Node);
    DL_Node *Next = DL_Node_GetNext(Node);
    
    /* 链表头尾节点一并检查 */
    if (Node->Prev == NULL)
        List->Head = Node->Next;
    if (Node->Next == NULL)
        List->Tail = Node->Prev;
    /* 接触关联索引 */
    if (Node->Prev != NULL)
        Node->Prev->Next = Node->Next;
    if (Node->Next != NULL)
        Node->Next->Prev = Node->Prev;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
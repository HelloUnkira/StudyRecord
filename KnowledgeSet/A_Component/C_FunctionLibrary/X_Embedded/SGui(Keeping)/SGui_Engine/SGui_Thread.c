#include "SGui_Kernel.h"
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#if 0
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#elif SGUI_USE_LINUX
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#include <stdlib.h>
#include <pthread.h>
#include <semaphore.h>
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
pthread_t       ThreadEngine;
pthread_mutex_t EventSyncMutex[SGui_EventQueue_All];
sem_t           EventSyncSem;
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
static void SGui_ThreadEventSyncLock(uint32_t Index)
{
    pthread_mutex_lock(&EventSyncMutex[Index]);
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
static void SGui_ThreadEventSyncUnlock(uint32_t Index)
{
    pthread_mutex_unlock(&EventSyncMutex[Index]);
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
static void SGui_ThreadEventSyncNotify(void)
{
    sem_post(&EventSyncSem);
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
static void SGui_ThreadEventSyncWait(void)
{
    sem_wait(&EventSyncSem);
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
static void * SGui_ThreadExecuteTask(void *Pointer)
{
    SGui_EngineExecute();
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void SGui_ThreadReady(void)
{
    SGui_EngineSyncRegister(SGui_ThreadEventSyncLock,
                            SGui_ThreadEventSyncUnlock,
                            SGui_ThreadEventSyncNotify,
                            SGui_ThreadEventSyncWait);
    SGui_EngineReady();
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void SGui_ThreadExecute(void)
{
    for (uint32_t Index = 0; Index < SGui_EventQueue_All; Index++)
        pthread_mutex_init(&EventSyncMutex[Index], NULL);
    sem_init(&EventSyncSem, 0, 5);
    
    pthread_create(&ThreadEngine, NULL, SGui_ThreadExecuteTask, NULL);
    pthread_join(ThreadEngine, NULL);
    
    sem_destroy(&EventSyncSem);
    for (uint32_t Index = 0; Index < SGui_EventQueue_All; Index++)
        pthread_mutex_destroy(&EventSyncMutex[Index]);
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
//继续添加其他平台
//#elif SGUI_USE_UNKONWN
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#else
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 事件同步锁(互斥锁:上锁) */
static void SGui_ThreadEventSyncLock(uint32_t Index)
{
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 事件同步锁(互斥锁:解锁) */
static void SGui_ThreadEventSyncUnlock(uint32_t Index)
{
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 事件同步信号(信号量:通知) */
static void SGui_ThreadEventSyncNotify(void)
{
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* 事件同步信号(信号量:等待) */
static void SGui_ThreadEventSyncWait(void)
{
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void SGui_ThreadReady(void)
{
    SGui_EngineSyncRegister(SGui_ThreadEventSyncLock,
                            SGui_ThreadEventSyncUnlock,
                            SGui_ThreadEventSyncNotify,
                            SGui_ThreadEventSyncWait);
    SGui_EngineReady();
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void SGui_ThreadExecute(void)
{
    SGui_EngineExecute();
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#endif
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/

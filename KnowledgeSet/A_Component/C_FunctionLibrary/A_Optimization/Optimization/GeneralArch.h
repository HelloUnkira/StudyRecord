#ifndef GENERAL_ARCH_H
#define GENERAL_ARCH_H
/*****************************************************************************/
/*****************************************************************************/
/*****************************************************************************/
#include <stdint.h>
#include <stdbool.h>
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* Label String-Ization */
#define Stringify_(Arg) #Arg
#define Stringify(Arg)  Stringify_(Arg)
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* Concatenate Label */
#define Concat_(T1, T2) T1 ## T2
#define Concat(T1, T2)  Concat_(T1, T2)
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
/* Fixes Text To Segment(.T1.T2.T3) */
#define Section_(T1, T2, T3)    \
    __attribute__(section("." Stringify_(T1) "." Stringify_(T2) "." Stringify_(T3)))
#define Section(T1, T2, T3) Section_(T1, T2, T3)
#define SectionUnique(Seg)  Section_(Seg, __FILE__, __COUNTER__)
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#define ARCH_USE_ARM    1
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#if 0
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#elif ARCH_USE_ARM
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#define ArchRegR(r)     ({u64 v; asm volatile("mrs %0, "##r : "=r" (v)); v;})
#define ArchRegW(v, r)  ({asm volatile("msr " ##r## ", %x0"::"rZ"((uint64_t)v));})
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#define Arch_CompBarr() do {asm volatile("":::"memory");} while (0)
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#define Arch_wfe()		asm volatile("wfe" : : : "memory")
#define Arch_wfi()		asm volatile("wfi" : : : "memory")
#define Arch_isb()		asm volatile("isb" : : : "memory")
#define Arch_dmb(opt)   asm volatile("dmb " #opt : : : "memory")
#define Arch_dsb(opt)	asm volatile("dsb " #opt : : : "memory")
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
//#elif ARCH_USE_UNKNOWN
//继续添加其他平台
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#else
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#endif
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#endif

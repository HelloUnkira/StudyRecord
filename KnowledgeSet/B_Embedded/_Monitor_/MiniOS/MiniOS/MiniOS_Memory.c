/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
//C std lib
#include <stddef.h>
#include <stdint.h>
#include <stdbool.h>
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#define LOG_PART_STATUS     1   /* 1:ENABLE,0:DISABLE */
#define LOG_PART_LEVEL      0   /* 0:DEBUG,1:INFO,2:WARN,3:ERROR,4:NONE */
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
#include "LogMessage.h"
#include "MemoryManageInterface.h"
#include "SpinLock.h"
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
static SpinLock MemoryLock = 0;
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void MiniOS_MemoryReady(void)
{
    MemoryManageConfigure();
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void * MiniOS_Alloc(uint32_t Size)
{
    uint8_t *Pointer = NULL;
    while (Spin_Lock(&MemoryLock) == false);
    if (MemoryManageHeapTake(Size, &Pointer) == false) {
        LOG_ERROR(true, "Heap Configure Is Too Small");
        while(1);
    }
    Spin_Unlock(&MemoryLock);
    return Pointer;
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
void MiniOS_Free(void *Pointer)
{
    while (Spin_Lock(&MemoryLock) == false);
    if (MemoryManageHeapGive(0, Pointer) == false) {
        LOG_ERROR(true, "Error Heap Memory Pointer");
        while(1);
    }
    Spin_Unlock(&MemoryLock);
}
/*************************************************************************************************/
/*************************************************************************************************/
/*************************************************************************************************/
